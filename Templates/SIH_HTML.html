<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delhi Load Curve</title>
    <link rel="stylesheet" href="{% static 'SIH_CSS.css' %}">
</head>
<body>
    <header>
        <h1>Delhi Load Curve</h1>
        <nav>
            <ul>
                <li><a href="https://www.delhisldc.org/HomeSldc.aspx">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Data</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="load-curve">
            <h2>Predicted Load Curve</h2>
            
            <!-- Date Input -->
            <div class="date-selection">
                <label for="dateInput">Select Date:</label>
                <!-- Using HTML5 date picker instead of separate selects for day, month, year -->
                <input type="date" id="dateInput" name="dateInput" required>
                <button id="submitDate" type="submit">Submit</button>
            </div>

            <!-- Blank space left for the result (Load, Temperature, Humidity) -->
            <div class="result" id="resultDiv">Prediction will be displayed here</div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Delhi Load Curve. All rights reserved.</p>
    </footer>

    <!-- JavaScript to send data to the backend and fetch prediction -->
    <script>
        document.getElementById('submitDate').addEventListener('click', function () {
            var selectedDate = document.getElementById('dateInput').value;
            if (!selectedDate) {
                document.getElementById('resultDiv').textContent = 'Please select a valid date.';
                return;
            }

            var dateParts = selectedDate.split("-");
            var year = parseInt(dateParts[0]);
            var month = parseInt(dateParts[1]);
            var day = parseInt(dateParts[2]);

            fetch('/api/predict/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken'),
                },
                body: JSON.stringify({
                    'selectDate': day,
                    'selectMonth': month,
                    'selectYear': year
                })
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('resultDiv');
                resultDiv.innerHTML = '';  // Clear previous results

                if (data.predictions) {
                    for (let time in data.predictions) {
                        const load = data.predictions[time];
                        const predictionDiv = document.createElement('div');
                        predictionDiv.textContent = `${time}: ${load.toFixed(2)} MW`;
                        resultDiv.appendChild(predictionDiv);
                    }
                } else if (data.error) {
                    resultDiv.textContent = 'Error: ' + data.error;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('resultDiv').textContent = 'An error occurred while fetching the prediction.';
            });
        });

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>
